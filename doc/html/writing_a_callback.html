<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Hexeng2D: Writing a Callback Function</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="hexeng2d_logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Hexeng2D<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">An open source 2D Game Engine framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('writing_a_callback.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Writing a Callback Function </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >To write a program using PortAudio, you must include the "portaudio.h" include file. You may wish to read "portaudio.h" because it contains a complete description of the PortAudio functions and constants. Alternatively, you could browse the [<a href="http://www.portaudio.com/docs/v19-doxydocs/portaudio_8h.html">http://www.portaudio.com/docs/v19-doxydocs/portaudio_8h.html</a> "portaudio.h" Doxygen page] </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="portaudio_8h.html">portaudio.h</a>&quot;</span></div>
<div class="ttc" id="aportaudio_8h_html"><div class="ttname"><a href="portaudio_8h.html">portaudio.h</a></div><div class="ttdoc">The portable PortAudio API.</div></div>
</div><!-- fragment --><p> The next task is to write your own "callback" function. The "callback" is a function that is called by the PortAudio engine whenever it has captured audio data, or when it needs more audio data for output.</p>
<p >Before we begin, it's important to realize that the callback is a delicate place. This is because some systems perform the callback in a special thread, or interrupt handler, and it is rarely treated the same as the rest of your code. For most modern systems, you won't be able to cause crashes by making disallowed calls in the callback, but if you want your code to produce glitch-free audio, you will have to make sure you avoid function calls that may take an unbounded amount of time to execute. Exactly what these are depend on your platform but almost certainly include the following: memory allocation/deallocation, I/O (including file I/O as well as console I/O, such as printf()), context switching (such as exec() or yield()), mutex operations, or anything else that might rely on the OS. If you think short critical sections are safe please go read about priority inversion. Windows and Mac OS schedulers have no real-time safe priority inversion prevention. Other platforms require special mutex flags. In addition, it is not safe to call any PortAudio API functions in the callback except as explicitly permitted in the documentation.</p>
<p >Your callback function must return an int and accept the exact parameters specified in this typedef:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="portaudio_8h.html#a8a60fb2a5ec9cbade3f54a9c978e2710">PaStreamCallback</a>( <span class="keyword">const</span> <span class="keywordtype">void</span> *input,</div>
<div class="line">                                      <span class="keywordtype">void</span> *output,</div>
<div class="line">                                      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> frameCount,</div>
<div class="line">                                      <span class="keyword">const</span> <a class="code hl_struct" href="struct_pa_stream_callback_time_info.html">PaStreamCallbackTimeInfo</a>* timeInfo,</div>
<div class="line">                                      <a class="code hl_typedef" href="portaudio_8h.html#a55a005924bcfa0424594f4f65cd4ae82">PaStreamCallbackFlags</a> statusFlags,</div>
<div class="line">                                      <span class="keywordtype">void</span> *userData ) ;</div>
<div class="ttc" id="aportaudio_8h_html_a55a005924bcfa0424594f4f65cd4ae82"><div class="ttname"><a href="portaudio_8h.html#a55a005924bcfa0424594f4f65cd4ae82">PaStreamCallbackFlags</a></div><div class="ttdeci">unsigned long PaStreamCallbackFlags</div><div class="ttdef"><b>Definition:</b> portaudio.h:712</div></div>
<div class="ttc" id="aportaudio_8h_html_a8a60fb2a5ec9cbade3f54a9c978e2710"><div class="ttname"><a href="portaudio_8h.html#a8a60fb2a5ec9cbade3f54a9c978e2710">PaStreamCallback</a></div><div class="ttdeci">int PaStreamCallback(const void *input, void *output, unsigned long frameCount, const PaStreamCallbackTimeInfo *timeInfo, PaStreamCallbackFlags statusFlags, void *userData)</div><div class="ttdef"><b>Definition:</b> portaudio.h:830</div></div>
<div class="ttc" id="astruct_pa_stream_callback_time_info_html"><div class="ttname"><a href="struct_pa_stream_callback_time_info.html">PaStreamCallbackTimeInfo</a></div><div class="ttdef"><b>Definition:</b> portaudio.h:699</div></div>
</div><!-- fragment --><p> Here is an example callback function from the test file "patests/patest_saw.c". It calculates a simple left and right sawtooth signal and writes it to the output buffer. Notice that in this example, the signals are of float data type. The signals must be between -1.0 and +1.0. You can also use 16 bit integers or other formats which are specified during setup, but floats are easiest to work with. You can pass a pointer to your data structure through PortAudio which will appear as userData.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">float</span> left_phase;</div>
<div class="line">    <span class="keywordtype">float</span> right_phase;</div>
<div class="line">}   </div>
<div class="line"><a class="code hl_struct" href="structpa_test_data.html">paTestData</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* This routine will be called by the PortAudio engine when audio is needed.</span></div>
<div class="line"><span class="comment"> * It may called at interrupt level on some machines so don&#39;t do anything</span></div>
<div class="line"><span class="comment"> * that could mess up the system like calling malloc() or free().</span></div>
<div class="line"><span class="comment">*/</span> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> patestCallback( <span class="keyword">const</span> <span class="keywordtype">void</span> *inputBuffer, <span class="keywordtype">void</span> *outputBuffer,</div>
<div class="line">                           <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> framesPerBuffer,</div>
<div class="line">                           <span class="keyword">const</span> <a class="code hl_struct" href="struct_pa_stream_callback_time_info.html">PaStreamCallbackTimeInfo</a>* timeInfo,</div>
<div class="line">                           <a class="code hl_typedef" href="portaudio_8h.html#a55a005924bcfa0424594f4f65cd4ae82">PaStreamCallbackFlags</a> statusFlags,</div>
<div class="line">                           <span class="keywordtype">void</span> *userData )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* Cast data passed through stream to our structure. */</span></div>
<div class="line">    <a class="code hl_struct" href="structpa_test_data.html">paTestData</a> *<a class="code hl_typedef" href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a> = (<a class="code hl_struct" href="structpa_test_data.html">paTestData</a>*)userData; </div>
<div class="line">    <span class="keywordtype">float</span> *out = (<span class="keywordtype">float</span>*)outputBuffer;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line">    (<a class="code hl_function" href="glad_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a>) inputBuffer; <span class="comment">/* Prevent unused variable warning. */</span></div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span>( i=0; i&lt;framesPerBuffer; i++ )</div>
<div class="line">    {</div>
<div class="line">        *out++ = <a class="code hl_typedef" href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a>-&gt;<a class="code hl_variable" href="structpa_test_data.html#a7395cffc18c4a1734f7e857f21ca1a9b">left_phase</a>;  <span class="comment">/* left */</span></div>
<div class="line">        *out++ = <a class="code hl_typedef" href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a>-&gt;right_phase;  <span class="comment">/* right */</span></div>
<div class="line">        <span class="comment">/* Generate simple sawtooth phaser that ranges between -1.0 and 1.0. */</span></div>
<div class="line">        <a class="code hl_typedef" href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a>-&gt;left_phase += 0.01f;</div>
<div class="line">        <span class="comment">/* When signal reaches top, drop back down. */</span></div>
<div class="line">        <span class="keywordflow">if</span>( <a class="code hl_typedef" href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a>-&gt;left_phase &gt;= 1.0f ) <a class="code hl_typedef" href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a>-&gt;left_phase -= 2.0f;</div>
<div class="line">        <span class="comment">/* higher pitch so we can distinguish left and right. */</span></div>
<div class="line">        <a class="code hl_typedef" href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a>-&gt;right_phase += 0.03f;</div>
<div class="line">        <span class="keywordflow">if</span>( <a class="code hl_typedef" href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a>-&gt;right_phase &gt;= 1.0f ) <a class="code hl_typedef" href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a>-&gt;right_phase -= 2.0f;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aglad_8h_html_a77bef421a06300ba60fc8c18453bcaef"><div class="ttname"><a href="glad_8h.html#a77bef421a06300ba60fc8c18453bcaef">data</a></div><div class="ttdeci">GLboolean * data</div><div class="ttdef"><b>Definition:</b> glad.h:1621</div></div>
<div class="ttc" id="aglad_8h_html_a950fc91edb4504f62f1c577bf4727c29"><div class="ttname"><a href="glad_8h.html#a950fc91edb4504f62f1c577bf4727c29">void</a></div><div class="ttdeci">typedef void(APIENTRYP PFNGLCULLFACEPROC)(GLenum mode)</div></div>
<div class="ttc" id="astructpa_test_data_html"><div class="ttname"><a href="structpa_test_data.html">paTestData</a></div><div class="ttdef"><b>Definition:</b> paex_mono_asio_channel_select.c:66</div></div>
<div class="ttc" id="astructpa_test_data_html_a7395cffc18c4a1734f7e857f21ca1a9b"><div class="ttname"><a href="structpa_test_data.html#a7395cffc18c4a1734f7e857f21ca1a9b">paTestData::left_phase</a></div><div class="ttdeci">float left_phase</div><div class="ttdef"><b>Definition:</b> paex_saw.c:52</div></div>
</div><!-- fragment --><p >Previous: <a class="el" href="tutorial_start.html">PortAudio Tutorials</a> | Next: <a class="el" href="initializing_portaudio.html">Initializing PortAudio</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
